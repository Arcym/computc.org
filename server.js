var express = require("express");

express = express();

//////////////////////////////////////////////
//////////////////TEMPLATING/////////////////
////////////////////////////////////////////

var handlebars = require("express3-handlebars");
handlebars = handlebars(require("./handlebars.options.js"));

express.engine("handlebars", handlebars);
express.set("view engine", "handlebars");
express.set("views", "content_directory/");

//////////////////////////////////////////////
//////////////////DATABASING/////////////////
////////////////////////////////////////////

var mongo = require("mongojs");
mongo = mongo("computc", ["users"]);

mongo.users.drop();

//////////////////////////////////////////////
////////////////AUTHENTICATING///////////////
////////////////////////////////////////////

var passport = require("passport");
require("./passport.config.js")(passport, mongo);

//////////////////////////////////////////////
/////////////////CONFIGURING/////////////////
////////////////////////////////////////////

var connect = require("connect");
var flash = require("connect-flash");

express.use(flash());
express.use(connect.json());
express.use(connect.urlencoded());
express.use(connect.cookieParser());

express.use(connect.session({secret: "thing"}));
express.use(passport.initialize());
express.use(passport.session());

//////////////////////////////////////////////
///////////////////ROUTING///////////////////
////////////////////////////////////////////

require("./router.config.js")(express, passport, mongo);

//////////////////////////////////////////////
//////////////////LISTENING//////////////////
////////////////////////////////////////////

var port = process.env.PORT || 21483;
console.log("127.0.0.1:" + port);
express.listen(port);
